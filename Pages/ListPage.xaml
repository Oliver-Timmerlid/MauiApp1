<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MauiApp1.ListPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:ViewModel="clr-namespace:MauiApp1.ViewModel"
    xmlns:ble="clr-namespace:Shiny.BluetoothLE.Managed;assembly=Shiny.BluetoothLE"
    Title="ListPage"
    x:DataType="ViewModel:ListPageViewModel"
    BackgroundColor="{DynamicResource OffBlack}"
    Shell.NavBarIsVisible="False">

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <CollectionView Grid.Row="0" ItemsSource="{Binding Devices}">
            <!--  CollectionView Grid.Row="0" ItemsSource="{Binding Users}"  -->
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="ble:ManagedScanResult">
                    <VerticalStackLayout
                        Margin="5"
                        Padding="10"
                        BackgroundColor="{DynamicResource OffBlack}">
                        <HorizontalStackLayout Spacing="5">
                            <Image
                                HeightRequest="30"
                                Source="heart.png"
                                VerticalOptions="Center"
                                WidthRequest="30" />
                            <!-- <Label FontSize="18" Text="{Binding Peripheral.Name, StringFormat='Device: {0}'}" /> -->
                            <Label FontSize="18" Text="{Binding Uuid, StringFormat='Device: {0}'}" />
                            <!--  Label FontSize="18" Text="{Binding Name, StringFormat='Device: {0}'}" /  -->
                            <!--  kan vara unik  -->
                            <!--<Label FontSize="18" Text="{Binding ManufacturerData, StringFormat='Device: {0}'}" />  kopplad till BluetoothadvertisementService.cs-->
                            <!--<Label FontSize="14" Text="{Binding ServiceUuids[0], StringFormat='UUID: {0}'}" /> -->
                            <!--  detta är vårt eget serviceuuid, som är "filter"  -->
                        </HorizontalStackLayout>
                        <BoxView
                            Margin="10,10,0,10"
                            BackgroundColor="Gray"
                            HeightRequest="1" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <HorizontalStackLayout Grid.Row="1" Padding="10">
            <Label Text="Starta sökning" VerticalOptions="Center" />
            <Switch IsToggled="{Binding IsToggled, Mode=TwoWay}" WidthRequest="200" />
            <ActivityIndicator
                IsRunning="{Binding IsScanning}"
                IsVisible="{Binding IsScanning}"
                VerticalOptions="Center" />
        </HorizontalStackLayout>
    </Grid>
</ContentPage>
